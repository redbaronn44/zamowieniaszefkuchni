<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lista zamówień - szef kuchni</title>
  <style>
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; max-width: 1024px; margin: 24px auto; padding: 24px; background-color: #f0f2f5; color: #333; }
    h1 { font-size: 28px; margin: 0 0 20px; color: #1a1a1a; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
    .row { display: flex; gap: 24px; }
    .panel { flex: 1; background: #ffffff; border: 1px solid #e0e0e0; padding: 24px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    label { display: block; margin: 12px 0 6px; font-weight: 600; color: #444; font-size: 14px; }
    textarea, input[type=number], input[type=text], select, input[type=date] { padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-family: inherit; font-size: 14px; box-sizing: border-box; width: 100%; }
    textarea { height: 140px; resize: vertical; }
    input[type=number] { width: 80px; }
    select { background-color: #fff; }
    textarea:focus, input:focus, select:focus { border-color: #007bff; box-shadow: 0 0 0 3px rgba(0,123,255,0.25); outline: none; }
    #productList { min-height: 100px; }
    .product { display: flex; align-items: center; gap: 12px; padding: 10px 0; border-bottom: 1px solid #f0f0f0; }
    .product:last-child { border-bottom: none; margin-bottom: 12px; }
    .product > div:first-child { flex: 1; font-weight: 500; }
    .controls { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px; border-top: 1px solid #f0f0f0; padding-top: 15px; }
    button { padding: 10px 14px; border-radius: 6px; border: 1px solid #ccc; background: #fff; cursor: pointer; font-size: 14px; font-weight: 500; }
    .primary { background: #007bff; color: #fff; border-color: #007bff; }
    .help { font-size: 13px; color: #666; margin-top: 15px; padding: 10px; background-color: #e9ecef; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>Zamawianie — lista produktów</h1>

  <div class="row">
    <div class="panel">
      <label>Tytuł zamówienia:</label>
      <input id="orderTitle" type="text" placeholder="np. Zamówienie na 18-stkę">

      <label>Data zamówienia:</label>
      <input id="orderDate" type="date">

      <label>Adres e-mail szefowej:</label>
      <input id="bossEmail" type="text" placeholder="szefowa@firma.pl">

      <label>Produkty (każdy w nowej linii):</label>
      <textarea id="productsInput" placeholder="np. Mąka\nCukier\nMasło"></textarea>

      <div class="controls">
        <button id="saveProducts">Zapisz listę produktów</button>
        <button id="editProducts">Edytuj ponownie</button>
        <button id="clearAll">Wyczyść wszystko</button>
      </div>

      <div class="help">Po zapisaniu produkty pojawią się po prawej. Przy zamówieniu zmieniasz tylko ilości. Nie używaj polskich znaków w tytule i nazwach plików.</div>
    </div>

    <div class="panel">
      <label>Aktualne zamówienie</label>
      <div id="productList"></div>

      <div class="controls">
        <button id="copyOrder">Kopiuj zamówienie</button>
        <button id="downloadTxt">Pobierz jako .txt</button>
        <button id="downloadPdf" class="primary">Zapisz jako PDF</button>
        <button id="openGmail">Otwórz Gmail</button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const productsInput = document.getElementById('productsInput');
    const saveBtn = document.getElementById('saveProducts');
    const productList = document.getElementById('productList');
    const downloadTxt = document.getElementById('downloadTxt');
    const downloadPdf = document.getElementById('downloadPdf');
    const copyOrder = document.getElementById('copyOrder');
    const bossEmail = document.getElementById('bossEmail');
    const orderTitle = document.getElementById('orderTitle');
    const orderDate = document.getElementById('orderDate');
    const openGmail = document.getElementById('openGmail');
    const editBtn = document.getElementById('editProducts');
    const clearAll = document.getElementById('clearAll');

    function sanitizeFileName(name){
      return name.replace(/[^a-z0-9_-]/gi,'_');
    }

    function load(){
      productsInput.value = localStorage.getItem('productsText') || '';
      bossEmail.value = localStorage.getItem('bossEmail') || '';
      orderTitle.value = localStorage.getItem('orderTitle') || '';
      orderDate.value = localStorage.getItem('orderDate') || '';
      renderProducts();
    }

    function save(){
      localStorage.setItem('productsText', productsInput.value);
      localStorage.setItem('bossEmail', bossEmail.value);
      localStorage.setItem('orderTitle', orderTitle.value);
      localStorage.setItem('orderDate', orderDate.value);
      renderProducts();
    }

    function parseProducts(){
      const raw = localStorage.getItem('productsText') || '';
      return raw.split('\n').map(x=>x.trim()).filter(x=>x);
    }

    function getQty(name){
      try { return JSON.parse(localStorage.getItem('qtys')||'{}')[name] || {value:'',unit:'kg'} }
      catch(e){ return {value:'',unit:'kg'} }
    }

    function setQty(name, val){
      let obj = {};
      try{ obj = JSON.parse(localStorage.getItem('qtys')||'{}') }catch(e){}
      obj[name] = val;
      localStorage.setItem('qtys', JSON.stringify(obj));
    }

    function renderProducts(){
      productList.innerHTML = '';
      const list = parseProducts();
      if(list.length===0){ productList.innerHTML='<div class="help">Brak produktów.</div>'; return; }
      list.forEach(name=>{
        const p=document.createElement('div');
        p.className='product';
        const label=document.createElement('div');
        label.style.flex='1';
        label.textContent=name;
        const q=getQty(name);
        const input=document.createElement('input');
        input.type='number'; input.min='0'; input.placeholder='ilość'; input.value=q.value;
        const select=document.createElement('select');
        ['kg','g','szt','opak'].forEach(u=>{ const o=document.createElement('option'); o.value=u; o.textContent=u; if(u===q.unit)o.selected=true; select.appendChild(o); });
        input.addEventListener('input',()=>setQty(name,{value:input.value,unit:select.value}));
        select.addEventListener('input',()=>setQty(name,{value:input.value,unit:select.value}));
        p.appendChild(label); p.appendChild(input); p.appendChild(select); productList.appendChild(p);
      });
    }

    function buildLines(){
      const date = orderDate.value ? orderDate.value : new Date().toLocaleDateString("pl-PL");
      const title = orderTitle.value.trim() || "Zamowienie";
      const header=[`Tytul: ${title}`, `Data: ${date}`, ``];
      const items=parseProducts().map(name=>{
        const q=getQty(name); return `${name}: ${q.value||'0'} ${q.unit||''}`;
      });
      return header.concat(items);
    }

    function buildFileName(ext){
      let name = sanitizeFileName(orderTitle.value || 'zamowienie');
      if(orderDate.value) name += "-" + orderDate.value;
      return name + ext;
    }

    saveBtn.addEventListener('click', save);
    editBtn.addEventListener('click',()=>productsInput.focus());
    clearAll.addEventListener('click',()=>{ localStorage.clear(); load(); });
    copyOrder.addEventListener('click',()=>{ navigator.clipboard.writeText(buildLines().join('\n')); });

    downloadTxt.addEventListener('click',()=>{
      const blob=new Blob([buildLines().join('\n')],{type:'text/plain'});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a'); a.href=url; a.download=buildFileName('.txt'); a.click();
      URL.revokeObjectURL(url);
    });

    downloadPdf.addEventListener('click',()=>{
      const { jsPDF } = window.jspdf;
      const doc=new jsPDF({unit:'pt',format:'a4'});
      let y=40; doc.setFontSize(14);
      buildLines().forEach(line=>{ doc.text(line,40,y); y+=18; });
      doc.save(buildFileName('.pdf'));
    });

    openGmail.addEventListener('click',()=>{
      const to=encodeURIComponent(bossEmail.value);
      const subject=encodeURIComponent(orderTitle.value || 'Zamowienie');
      const body=encodeURIComponent(buildLines().join('\n'));
      window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${to}&su=${subject}&body=${body}`,"_blank");
    });

    load();
  </script>
</body>
</html>
